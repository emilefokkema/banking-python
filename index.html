<html>
	<head>
		<title>Process my banking statements</title>
		<script
		  src="https://code.jquery.com/jquery-3.3.1.min.js"
		  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
		  crossorigin="anonymous"></script>
		<style type="text/css">
			body{
				margin:0px;
				padding: 0px;
			}
			.period-list{
				margin:10px;
				padding: 10px;
			}
			.period-list-item{
				padding: 10px;
				font-family: monospace;
				border:1pt solid #000;
			}
			.category{
				padding:5px;
				margin: 5px;
				border:0.5px solid #ccc;
			}
		</style>
	</head>
	<body>
		<div class="period-list"></div>
	<script>
		(function($){
			var $list = $(".period-list").first();

			var makePeriodItem = function(data){
				console.log(data)
				var $root = $("<div class=\"period-list-item\"><div>van "+data.from+" t/m "+data.through+"</div></div>");
				$root.append(makeCategory("Bij", data.Bij))
				$root.append(makeCategory("Af", data.Af))
				$list.append($root);
			};

			var makeCategory = function(name, obj){
				var total = (typeof obj === typeof 6) ? obj : obj.total;
				var $root = $("<div class=\"category\">"+name+": "+total+"</div>");
				if(typeof obj !== "Number" && obj.total !== undefined){
					for(var p in obj){
						if(obj.hasOwnProperty(p) && p !== "total"){
							$root.append(makeCategory(p, obj[p]))
						}
					}
				}
				return $root;
			}

			var makePeriodItems = function(list){
				for(var i=0;i<list.length;i++){
					makePeriodItem(list[i].file)
				}
			}

			$.get( "/api/complete", function(d) {
			  makePeriodItems(d)
			});
		})($);
	</script>
	</body>
</html>