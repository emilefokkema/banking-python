<html>
	<head>
		<title>Process my banking statements</title>
		<script src="https://cdn.jsdelivr.net/npm/vue"></script>
		<!-- <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script> -->
		<script src="index.js"></script>
		
		<link rel="stylesheet" type="text/css" href="index.css">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous">
	</head>
	<body>

		<script type="text/template" id="categoryTemplate">
			<div class="category" v-bind:class="{collapsed:collapsed,'category-top':top}">
				<span v-bind:class="{'toggle-collapse':!isSimple}" v-on:click="toggleCollapse">
					<span class="neither" v-if="isSimple"></span>
					<template v-else>
						<span class="plus"></span>
						<span class="minus"></span>
					</template>
					{{categoryData.name}}<expectation v-if="categoryData.expectation" v-bind:expectation="categoryData.expectation"></expectation>: <amount v-bind:numberOfCents="categoryData.total"></amount>
				</span>
				<div class="category-set" v-if="categoryData.categories">
					<category v-for="category in categoryData.categories" v-bind:categoryData="category" v-bind:top="false"></category>
				</div>
				<row-collection v-if="categoryData.rows" v-bind:data="categoryData.rows"></row-collection>
			</div>
		</script>
		<script type="text/template" id="removeButtonTemplate">
			<span class="fas fa-times remove-button" v-on:click="click"></span>
		</script>
		<script type="text/template" id="rowCollectionTemplate">
			<div class="category-set">
				<row v-for="row in data.items" v-bind:row="row"></row>
				<span class="more" v-if="data.more">(en nog {{data.more}})</span>
			</div>
		</script>
		<script type="text/template" id="periodItemTemplate">
			<div class="panel period-list-item" v-bind:class="{'removing':isRemoving,'with-end':data.hasEnd, 'with-beginning':data.hasBeginning, 'collapsed':collapsed}">
				<div class="panel-header"><span class="panel-title" v-on:click="toggleCollapse">{{periodDescription}}</span> <remove-button v-if="data.hasEnd" v-on:click="remove"></remove-button></div>
				<div class="panel-body">
					<category v-bind:top="true" v-bind:categoryData="data.Bij"></category>
					<category v-bind:top="true" v-bind:categoryData="data.Af"></category>
				</div>
			</div>
		</script>
		<script type="text/template" id="expectationTemplate">
			<span class="expectation" v-bind:title="dateSummary"> ({{expectation.actual}})</span>
		</script>
		<script type="text/template" id="rowTemplate">
			<div class="row">
				<date v-bind:date="dateProperty.value" v-if="dateProperty" class="row-part"></date>
				<div class="row-part">
					<div class="string-property" v-for="prop in stringProperties"><span class="string-property-name" v-if="stringProperties.length > 1">{{prop.name}}:&nbsp;</span>{{prop.value}}</div>
				</div>
				<amount v-bind:numberOfCents="amountProperty.value" v-if="amountProperty" class="row-part"></amount>
			</div>
		</script>
		<script type="text/template" id="settingsTemplate">
			<div class="panel" v-bind:class="{'collapsed':collapsed}">
				<div class="panel-header"><span class="fas fa-cog panel-title" v-on:click="toggleCollapse"></span></div>
				<div class="panel-body">
					<div class="column-slots">
						<column-slot v-for="slot in slots" v-bind:data="slot"></column-slot>
					</div>
				</div>
			</div>
		</script>
		<script type="text/template" id="columnSlotTemplate">
			<div class="column-slot">
				<div class="slot-index">{{data.index}}<div>
				<template v-if="data.type == 'date'">
					<span class="fas fa-calendar-alt"></span><input class="input" v-model="data.definition.pattern"/>
				</template>
				<template v-if="data.type == 'direction'">
					<div>
						<span class="fas fa-plus"></span><input class="input" v-model="data.definition.incoming"/>
					</div>
					<div>
						<span class="fas fa-minus"></span><input class="input" v-model="data.definition.outgoing"/>
					</div>
				</template>
				<span v-if="!data.type"><input class="input" v-model="data.newName" placeholder="?" /></span>
				<span v-if="data.type == 'string'"><input class="input" v-model="data.definition.name" /></span>
				<span class="fas fa-dollar-sign" v-if="data.type == 'amount'"></span>
			</div>
		</script>
		<div id="app">
			<settings v-bind:data="settings" ref="settings"></settings>
			<div>
				<div class="empty panel" v-if="completePeriods.length == 0">(no history)</div>
				<period-item v-for="period in completePeriods" v-bind:data="period.file" v-bind:file-name="period.fileName" v-on:removal="refreshComplete" v-on:error="displayError" :key="period.fileName"></period-item>
			</div>
			<div>
				<period-item v-for="period in incompletePeriods" v-bind:data="period.file" v-bind:file-name="period.fileName"></period-item>
			</div>
			<div>
				<input type="file" ref="file" name="file" id="file" accept=".csv" class="file-input" v-on:change="fileNameChange"/><label class="input" for="file">{{fileName || "Choose a file"}}</label>
				<input type="button" class="input" value="submit" v-on:click="postCsv" />
			</div>
			<div class="error" v-if="errorMessage">{{errorMessage}}</div>
		</div>
	</body>
</html>